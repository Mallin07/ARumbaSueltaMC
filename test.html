<!doctype html>
<meta charset="utf-8" />
<title>Firebase Storage test (sin login)</title>
<button id="upload">Subir blob</button>
<pre id="out"></pre>

<script type="module">
  const log = (...a) => document.getElementById('out').textContent += a.join(' ') + '\n';

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getStorage, ref, uploadBytes, getDownloadURL }
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

  const app = initializeApp({
    apiKey: "AIzaSyASxL2FjzUdP0Lm5pzfV5xmA1nywPMWdjw",
    authDomain: "arsmc-873f3.firebaseapp.com", 
    projectId: "arsmc-873f3",
    storageBucket: "arsmc-873f3.appspot.com",
    messagingSenderId: "558517245585",
    appId: "1:558517245585:web:9816b346b67c4d7cb69130",
    measurementId: "G-8WGXBDMSVZ"
  });

  const storage = getStorage(app);

  document.getElementById('upload').onclick = async () => {
    try {
      // Subimos un PNG mínimo con contentType image/* para evitar bloqueos por tipo
      const blob = new Blob(["dummy"], { type: "image/png" });
      const r = ref(storage, `debug/test-${Date.now()}.png`);
      await uploadBytes(r, blob, { contentType: "image/png" });
      const url = await getDownloadURL(r);
      log('✅ Subida OK:', url);
    } catch(e){
      log('❌ Error subida:', e.code || e.message);
      console.error(e);
    }
  };
</script>
